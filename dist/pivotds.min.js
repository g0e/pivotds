var pivotds=function(){"use strict";var a={version:"0.1.0"};return a.options={},a.separator="___",a.nested_coupler=".",a.Pivot=function(b,c){this.rows=[],this.cols=[],this.aggs=[],this.filters={},this.separator=a.separator,void 0!==b&&(this.dataset=b),void 0!==c&&this.setup_options(c)},a.Pivot.prototype.setup_options=function(b){return a.Util.merge(this,b)},a.Pivot.prototype.set_dataset=function(a){this.dataset=a},a.Pivot.prototype.execute=function(a){void 0===a&&(a=this.dataset),this.prepare_conditions();var b=this.filter_dataset(a),c=this.create_dict(b);c=this.do_aggs(c);var d=this.restore_dataset(c);return d},a.Pivot.prototype.prepare_conditions=function(){0===this.aggs.length&&this.aggs.push({key:null,type:"count"});for(var b,c,d=0,e=this.aggs.length;e>d;d++)if(b=this.aggs[d],"custom"==b.type){if("function"!=typeof b.func)throw new Error("custom aggregation type required func")}else{if(c=a.AggsFunc.name_to_func[b.type],void 0===c)throw new Error("invalid agg.type");b.func=c}},a.Pivot.prototype.filter_dataset=function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b=a[d],c.push(b);return c},a.Pivot.prototype.create_row_key=function(a){for(var b,c=[],d=0,e=this.rows.length;e>d;d++)b=a[this.rows[d]],void 0!==b?c.push(""+b):c.push("");return c.join(this.separator)},a.Pivot.prototype.create_col_key=function(a){for(var b,c=[],d=0,e=this.cols.length;e>d;d++)b=a[this.cols[d]],void 0!==b?c.push(""+b):c.push("");return c.join(this.separator)},a.Pivot.prototype.restore_row_vals=function(a){var b={},c=a.split(this.separator);if(c.length!==this.rows.length)throw new Error("can't restore row_key");for(var d=0,e=c.length;e>d;d++)b[this.rows[d]]=c[d];return b},a.Pivot.prototype.restore_col_vals=function(a){var b={},c=a.split(this.separator);if(c.length!==this.cols.length)throw new Error("can't restore col_key");for(var d=0,e=c.length;e>d;d++)b[this.cols[d]]=c[d];return b},a.Pivot.prototype.create_dict=function(a){for(var b,c,d,e,f={},g=0,h=a.length;h>g;g++){b=a[g],c=this.create_row_key(b),d=this.create_col_key(b),void 0===f[c]&&(f[c]={}),void 0===f[c][d]&&(f[c][d]={});for(var i=0,j=this.aggs.length;j>i;i++)e=this.aggs[i].key,void 0===f[c][d][e]&&(f[c][d][e]=[]),f[c][d][e].push(b[e])}return f},a.Pivot.prototype.do_aggs=function(a){var b,c,d,e,f;b=Object.keys(a);for(var g=0,h=b.length;h>g;g++){d=a[b[g]],c=Object.keys(d);for(var i=0,j=c.length;j>i;i++){e=d[c[i]];for(var k=0,l=this.aggs.length;l>k;k++)f=this.aggs[k],e[f.key]=f.func(e[f.key])}}return a},a.Pivot.prototype.restore_dataset=function(a){var b,c,d,e,f,g,h,i=[],j={};c=Object.keys(a);for(var k=0,l=c.length;l>k;k++){b=this.restore_row_vals(c[k]),f=a[c[k]],d=Object.keys(f);for(var m=0,n=d.length;n>m;m++){g=f[d[m]],e=Object.keys(g);for(var o=0,p=e.length;p>o;o++)h=[d[m],e[o]].join(this.separator),0===h.indexOf(this.separator)&&(h=h.substr(this.separator.length)),b[h]=g[e[o]],j[h]=!0}i.push(b)}return j=Object.keys(j),i=this.fillup_col(i,j)},a.Pivot.prototype.fillup_col=function(a,b){for(var c=0,d=a.length;d>c;c++)for(var e=0,f=b.length;f>e;e++)void 0===a[c][b[e]]&&(a[c][b[e]]=0);return a},a.AggsFunc={},a.AggsFunc.count=function(a){return a.length},a.AggsFunc.sum=function(a){for(var b=0,c=0,d=a.length;d>c;c++)b+=a[c];return b},a.AggsFunc.average=function(b){return 1*a.AggsFunc.sum(b)/b.length},a.AggsFunc.max=function(a){return Math.max.apply(null,a)},a.AggsFunc.min=function(a){return Math.min.apply(null,a)},a.AggsFunc.name_to_func={count:a.AggsFunc.count,sum:a.AggsFunc.sum,average:a.AggsFunc.average,max:a.AggsFunc.max,min:a.AggsFunc.min},a.Util={},a.Util.merge=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=d in b&&"object"==typeof b[d]&&"object"==typeof c[d]?a.Util.merge(b[d],c[d]):c[d]);return b},a.Util.copy=function(b){if(null===b||void 0===b||"object"!=typeof b)return b;var c;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;d++)c[d]=a.Util.copy(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.Util.copy(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a}();